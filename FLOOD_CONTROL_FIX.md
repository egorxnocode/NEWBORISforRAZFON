# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –ó–∞—â–∏—Ç–∞ –æ—Ç —Ñ–ª—É–¥-–∫–æ–Ω—Ç—Ä–æ–ª—è Telegram

## üö® –ü—Ä–æ–±–ª–µ–º–∞

```
ERROR - –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∫–∞–Ω–∞–ª–∞ @channel: 
Telegram server says - Flood control exceeded on method 'GetChat' 
Retry in 1882 seconds.
```

### –ü—Ä–∏—á–∏–Ω–∞

–ë–æ—Ç —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–ª –ø—É–±–ª–∏—á–Ω–æ—Å—Ç—å –∫–∞–Ω–∞–ª–æ–≤ —á–µ—Ä–µ–∑ API Telegram (`bot.get_chat()`), —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—é –ª–∏–º–∏—Ç–æ–≤:
- –ü—Ä–∏ –∫–∞–∂–¥–æ–π –ø–æ–ø—ã—Ç–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–∞–Ω–∞–ª
- –ü—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
- –ë–µ–∑ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –î–æ–±–∞–≤–ª–µ–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞–Ω–∞–ª–æ–≤

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫—ç—à–∞:**
- **TTL (–≤—Ä–µ–º—è –∂–∏–∑–Ω–∏):** 5 –º–∏–Ω—É—Ç (300 —Å–µ–∫—É–Ω–¥)
- **–¢–∏–ø:** In-memory –∫—ç—à (—Å–ª–æ–≤–∞—Ä—å –≤ Python)
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:**
  ```python
  {
    "channel_username": {
      "is_public": True/False,
      "expires_at": datetime
    }
  }
  ```

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü–µ—Ä–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–Ω–∞–ª–∞:**
   - –ë–æ—Ç –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ API Telegram
   - –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –∫—ç—à –Ω–∞ 5 –º–∏–Ω—É—Ç
   - –û—Ç–≤–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

2. **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç):**
   - –†–µ–∑—É–ª—å—Ç–∞—Ç –±–µ—Ä–µ—Ç—Å—è –∏–∑ –∫—ç—à–∞ **–ë–ï–ó –∑–∞–ø—Ä–æ—Å–∞ –∫ API**
   - –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
   - –ù–∏–∫–∞–∫–∏—Ö –ª–∏–º–∏—Ç–æ–≤

3. **–ü–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è 5 –º–∏–Ω—É—Ç:**
   - –ö—ç—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
   - –ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ API
   - –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–Ω–æ–≤–∞ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚ùå –§–ª—É–¥-–∫–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–∏ 30-50 –ø—Ä–æ–≤–µ—Ä–∫–∞—Ö
- ‚ùå –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ 30 –º–∏–Ω—É—Ç
- ‚ùå –ö–∞–∂–¥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ = API –∑–∞–ø—Ä–æ—Å

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ –ù–µ—Ç —Ñ–ª—É–¥-–∫–æ–Ω—Ç—Ä–æ–ª—è
- ‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ API –∑–∞–ø—Ä–æ—Å–æ–≤ —É–º–µ–Ω—å—à–µ–Ω–æ –≤ **10-100 —Ä–∞–∑**
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã –∏–∑ –∫—ç—à–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§–∞–π–ª: `bot.py`

```python
# –ö—ç—à –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Ñ–ª—É–¥-–∫–æ–Ω—Ç—Ä–æ–ª—è
channel_cache = {}
CHANNEL_CACHE_TTL = 300  # 5 –º–∏–Ω—É—Ç

async def is_channel_public(channel_username: str) -> bool:
    # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
    if channel_username in channel_cache:
        cached = channel_cache[channel_username]
        if datetime.now() < cached["expires_at"]:
            return cached["is_public"]  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–∑ –∫—ç—à–∞
    
    # 2. –î–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å –∫ API (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫—ç—à–∞ –Ω–µ—Ç)
    try:
        chat = await bot.get_chat(f"@{channel_username}")
        is_public = True
    except Exception:
        is_public = False
    
    # 3. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
    channel_cache[channel_username] = {
        "is_public": is_public,
        "expires_at": datetime.now() + timedelta(seconds=300)
    }
    
    return is_public
```

## üéØ –ö–æ–≥–¥–∞ –∫—ç—à –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

### –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫—ç—à–∞:

1. **–ú–Ω–æ–∂–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∫–∞–Ω–∞–ª**
   - –ü–µ—Ä–≤—ã–π: API –∑–∞–ø—Ä–æ—Å
   - –û—Å—Ç–∞–ª—å–Ω—ã–µ (–≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω): –∏–∑ –∫—ç—à–∞

2. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–Ω–∞–ª**
   - –†–µ–∑—É–ª—å—Ç–∞—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –±–µ—Ä–µ—Ç—Å—è –∏–∑ –∫—ç—à–∞

3. **–ú–∞—Å—Å–æ–≤–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è**
   - –ö—ç—à –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –ª–∏–º–∏—Ç–æ–≤ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è, –≤ `bot.py`:

```python
# –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: 5 –º–∏–Ω—É—Ç
CHANNEL_CACHE_TTL = 300

# –ü—Ä–∏–º–µ—Ä—ã –¥—Ä—É–≥–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π:
CHANNEL_CACHE_TTL = 600   # 10 –º–∏–Ω—É—Ç (–¥–æ–ª—å—à–µ, –º–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤)
CHANNEL_CACHE_TTL = 180   # 3 –º–∏–Ω—É—Ç—ã (–∫–æ—Ä–æ—á–µ, –∞–∫—Ç—É–∞–ª—å–Ω–µ–µ –¥–∞–Ω–Ω—ã–µ)
CHANNEL_CACHE_TTL = 900   # 15 –º–∏–Ω—É—Ç (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —ç–∫–æ–Ω–æ–º–∏–º API)
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –û—Å—Ç–∞–≤–∏—Ç—å 5 –º–∏–Ω—É—Ç (300 —Å–µ–∫—É–Ω–¥) - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å.

## üìù –õ–æ–≥–∏

### –ù–æ–≤—ã–µ debug-–ª–æ–≥–∏ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏):

```
‚úÖ –ö–∞–Ω–∞–ª @channel –Ω–∞–π–¥–µ–Ω –≤ –∫—ç—à–µ: True
üóëÔ∏è –ö—ç—à –¥–ª—è @channel –∏—Å—Ç–µ–∫, —É–¥–∞–ª–µ–Ω
üîç –ü—Ä–æ–≤–µ—Ä—è—é –∫–∞–Ω–∞–ª @channel —á–µ—Ä–µ–∑ API...
üíæ –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è @channel —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –∫—ç—à –Ω–∞ 300—Å
```

–ß—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å debug-–ª–æ–≥–∏, –∏–∑–º–µ–Ω–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:

```python
# –í bot.py
logging.basicConfig(
    level=logging.DEBUG,  # –ë—ã–ª–æ: INFO
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
```

## üöÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
cd /opt/NEWBORISforRAZFON
git pull origin main
docker-compose restart telegram-bot
docker logs -f telegram-bot
```

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∏ —Ñ–ª—É–¥-–∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ–ª–∂–Ω—ã –∏—Å—á–µ–∑–Ω—É—Ç—å.

## ‚ùì FAQ

### –í: –ö–∞–∫ —á–∞—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫—ç—à?
**–û:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞.

### –í: –ß—Ç–æ –µ—Å–ª–∏ –∫–∞–Ω–∞–ª —Å—Ç–∞–ª –ø—Ä–∏–≤–∞—Ç–Ω—ã–º?
**–û:** –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–±–Ω–æ–≤–∏—Ç—Å—è –º–∞–∫—Å–∏–º—É–º —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.

### –í: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ª–∏ –∫—ç—à –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞?
**–û:** –ù–µ—Ç, –∫—ç—à –≤ –ø–∞–º—è—Ç–∏ –æ—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ. –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - –æ–Ω –±—ã—Å—Ç—Ä–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è —Å–Ω–æ–≤–∞.

### –í: –ú–æ–∂–Ω–æ –ª–∏ —É–≤–∏–¥–µ—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫—ç—à–∞?
**–û:** –î–∞, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å admin-–∫–æ–º–∞–Ω–¥—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (–ø–æ –∑–∞–ø—Ä–æ—Å—É).

### –í: –í–ª–∏—è–µ—Ç –ª–∏ —ç—Ç–æ –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏?
**–û:** –î–∞! –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑ –∫—ç—à–∞ **–º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è** (0.001—Å –≤–º–µ—Å—Ç–æ 1-2—Å —á–µ—Ä–µ–∑ API).

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–ù–µ—Ç –æ—à–∏–±–æ–∫ —Ñ–ª—É–¥-–∫–æ–Ω—Ç—Ä–æ–ª—è:**
   ```bash
   docker logs telegram-bot | grep "Flood control"
   # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç–æ
   ```

2. **–ö—ç—à —Ä–∞–±–æ—Ç–∞–µ—Ç (—Å DEBUG –ª–æ–≥–∞–º–∏):**
   ```bash
   docker logs telegram-bot | grep "–Ω–∞–π–¥–µ–Ω –≤ –∫—ç—à–µ"
   # –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–∏—Å–∏
   ```

3. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç:**
   - –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–∞–Ω–∞–ª
   - –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ —á–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É
   - –í—Ç–æ—Ä–∞—è –ø–æ–ø—ã—Ç–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–π

---

**–ö–æ–º–º–∏—Ç:** `2d76f6f`  
**–î–∞—Ç–∞:** 2026-01-20  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ
