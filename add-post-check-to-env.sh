#!/bin/bash

# Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð²Ð¾Ð·Ñ€Ð°ÑÑ‚Ð° Ð¿Ð¾ÑÑ‚Ð¾Ð² Ð² .env

echo "ðŸ”§ Ð”ÐžÐ‘ÐÐ’Ð›Ð•ÐÐ˜Ð• ÐÐÐ¡Ð¢Ð ÐžÐ•Ðš ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ˜ Ð’ÐžÐ—Ð ÐÐ¡Ð¢Ð ÐŸÐžÐ¡Ð¢ÐžÐ’"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

ENV_FILE=".env"

if [ ! -f "$ENV_FILE" ]; then
    echo "âŒ Ð¤Ð°Ð¹Ð» .env Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½!"
    exit 1
fi

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, ÐµÑÑ‚ÑŒ Ð»Ð¸ ÑƒÐ¶Ðµ ÑÑ‚Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸
if grep -q "CHECK_POST_AGE" "$ENV_FILE"; then
    echo "âœ… ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° CHECK_POST_AGE ÑƒÐ¶Ðµ ÐµÑÑ‚ÑŒ Ð² .env"
else
    echo "âž• Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð² .env..."
    
    cat >> "$ENV_FILE" << 'EOF'

# ============================================================
# POST VALIDATION
# ============================================================
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð²Ð¾Ð·Ñ€Ð°ÑÑ‚Ð° Ð¿Ð¾ÑÑ‚Ð¾Ð² (Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ Ð¿Ñ€Ð°Ð² Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð° Ð±Ð¾Ñ‚Ð° Ð² ÐºÐ°Ð½Ð°Ð»Ð°Ñ…)
# ÐŸÐ¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾ (false)
CHECK_POST_AGE=false

# ÐœÐ°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð²Ð¾Ð·Ñ€Ð°ÑÑ‚ Ð¿Ð¾ÑÑ‚Ð° Ð² Ñ‡Ð°ÑÐ°Ñ… (Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐµÑÐ»Ð¸ CHECK_POST_AGE=true)
MAX_POST_AGE_HOURS=23
EOF

    echo "âœ… ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ñ‹!"
fi

echo ""
echo "ðŸ“‹ Ð¢ÐµÐºÑƒÑ‰Ð¸Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸:"
grep "CHECK_POST_AGE\|MAX_POST_AGE_HOURS" "$ENV_FILE"

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ… Ð“ÐžÐ¢ÐžÐ’Ðž!"
echo ""
echo "â„¹ï¸  ÐŸÐ¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð²Ð¾Ð·Ñ€Ð°ÑÑ‚Ð° Ð¿Ð¾ÑÑ‚Ð¾Ð² ÐžÐ¢ÐšÐ›Ð®Ð§Ð•ÐÐ (CHECK_POST_AGE=false)"
echo "â„¹ï¸  Ð­Ñ‚Ð¾ Ð¾Ð·Ð½Ð°Ñ‡Ð°ÐµÑ‚, Ñ‡Ñ‚Ð¾ Ð±Ð¾Ñ‚ ÐÐ• Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ Ð¿Ñ€Ð°Ð² Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð° Ð² ÐºÐ°Ð½Ð°Ð»Ð°Ñ…"
echo ""
echo "ðŸ“– ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ: POST_AGE_CHECK.md"
echo ""
echo "ðŸ”„ ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð±Ð¾Ñ‚Ð° Ð´Ð»Ñ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹:"
echo "   docker restart telegram-bot"

